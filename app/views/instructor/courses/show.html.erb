<script>
	$(function() {
		$('.lessons').sortable({
			update: function( event, ui ) {
				$.ajax({
					type: 'PUT',
					url: ui.item.data('update-url'),
					dataType: 'json',
					data: { lesson: { row_order_position: ui.item.index() } }
				});
			}
		});
		
		$('.sections').sortable({
			update: function( event, ui ) {
				$.ajax({
					type: 'PUT',
					url: ui.item.data('update-url'),
					dataType: 'json',
					data: { section: { row_order_position: ui.item.index() } }
				});
			}
		});
	});
</script>

<div class="enhance-box col-xs-10 col-xs-offset-1">
	<h1 class="text-center"><%= current_course.title %></h1><!-- /.text-center -->
	<%= image_tag current_course.image, class: 'img-responsive course-image' %>

	<%= link_to 'Preview as Student', course_path(current_course), class: 'btn btn-warning pull-right' %>

	<div class="clear"></div><!-- /.clear -->

	<div class="text-center">
		<%= link_to 'Add Section', new_instructor_course_section_path(current_course), class: 'btn btn-primary btn-lg new-section-btn' %>
	</div><!-- /.text-center -->

	<ul class="sections">
		<% current_course.sections.rank(:row_order).each do |section| %>
		<li class="section-li" data-update-url="<%= instructor_section_path(section) %>">
			<div class="section-header">
				<div class="col-xs-11 section-title">
					<i class="glyphicon glyphicon-option-vertical"></i>
					<%= section.title %>
				</div>
				
				<div class="col-xs-1">
					<%= link_to 'New Lesson', new_instructor_section_lesson_path(section), class: 'new-lesson-btn btn btn-primary btn-xs' %>
				</div>
			</div>
			
			<br class="clear">
			<ul class="lessons">
				<% section.lessons.rank(:row_order).each do |lesson| %>
				<li data-update-url="<%= instructor_lesson_path(lesson) %>">
					<div class="col-xs-1">
						<i class="glyphicon glyphicon-option-vertical"></i>
					</div>
					
					<div class="col-xs-11 text-center">
						<p><strong><%= lesson.title %></strong></p>
						<p><%= lesson.subtitle %></p>
					</div>
				</li>
				<% end %>
			</ul>
		</li>
		<% end %>
	</ul>
</div><!-- /.enhance-box col-xs-4 col-xs-offset-4 -->